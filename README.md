<h3 align="center">
Минеева Екатерина  <br />
НИУ ВШЭ ФКН БПМИ-152 <br />
Проект  <br />
</h3>
<h2 align="center">
«Семантическая сегментация изображений  <br />
для автоматической разметки аэрофотоснимков»  <br />
</h2>
<h3 align="center">
под руководством ментора Вадима Горбачёва
</h3>
 <br />

#### Постановка задачи

Проанализировать аэрофотоснимки и автоматизировать процесс классификации объектов, изображенных на снимке. 

В данном проекте анализируются высококачественные аэрофотоснимки немецких городов Vaihingen и Potsdam. Требуется отнести каждый пиксел изображения к одному из классов:

* Непрозрачные поверхности
* Здания
* Низкая растительность
* Деревья
* Машины
* Дорога/прочее

В данные предоставленные для обучения и тестирования входят:

* Исходные снимки
* TOP - синтезированный снимок из бесконечно удалённой точки
* DSM – карта высот объектов
* nDSM – карта высот объектов нормализованная относительно уровня земли 
* PAN – черно-белые снимки
* CII - инфракрасный канал

Кроме того для части снимков имеются Ground Truth изображения (размеченные вручную),что позволяет применить методы машинного обучения к данной задачи. На данный момент открыт [контест](http://www2.isprs.org/commissions/comm3/wg4/semantic-labeling.html), куда все желающие могут отправить свой алгоритм и посоревноваться с другими участниками. Некоторые участники достигли высокой точности в разметке снимков и опубликовали ряд статей по данной тематике. 

 <br />

#### План реализации проекта

1. Первая контрольная точка - 17 декабря 2016:
    * Изучение задачи, методов ее решения и постановка технического задания
    * Реализация пересегментации и оценка погрешности, которую она вносит
2. Вторая контрольная точка - 20-25 марта 2017:
    * Выделение различных признаков 
    * Обучение на их основе Random Forest 
    * Оценка полученных результатов
3. Третья контрольная точка - 29 мая - 3 июня
    * Изучение более продвинутых классификаторов и признаков
    * Изучение статей и эксперименты со свежими результатами полученными в данной области.
    * Реализация полного функционала и отправка решения в контест.
    
    


<br />
#### Методы решения

Для решения данной задачи применяется метод машинного обучения, реализация состоит из нескольких шагов

1. Предварительная сегментация изображения на "суперпиксели" -- данный шаг обусловлен двумя факторами: во-первых, у аэрофотоснимков, которые предстоит анализировать, высокое разрешение, поэтому анализ каждого пиксела изображения потребовал бы очень больших мощностей, а, во-вторых, подобное решение не так эффективно, поскольку объекты, которые представлены на снимках имеют сравнительно большой размер, а характеристики каждого отдельного пиксела не так важны -- куда более информативен анализ в совокупности.
В качестве алгоритма, реализующего предварительную сегментацию был выбран SLIC (Simple Linear Iterative Clustering), поскольку:
    * ошибка, которую вносит пересегментация при помощи SLIC, минимальна: проверено эмпирически
    * сегменты, которые выделяет данный алгоритм, равномерно распределены по всему изображения и их размер не сильно различается

2. Признаки, по которым будет происходит анализ изображения
    * Цвет и разница цветов в соседних областях -- одно из самых простых и вместе с тем важных различий 
    * Дисперсия DMS
    * Контекст - например, среднее по цветовым каналам сегментов, расположенным по соседству с суперпикселем. Существенно увеличило информативность центрирование случайной величины "цвет соседа" и последующая нормировка, пропорциональная размеру области, по которой сегменты граничили 
    * Вероятность принадлежности к каждому из классов
    * Вероятность пары классов оказаться по соседству
    
    (Однако найти полноценное применение последним двум пунктам пока не вышло -- значительного улучшения  результатов не наблюдалось)

3. Пока что в качестве классификатора был выбран Random Forest в силу простоты и удобства. Его работа стабильна и позволяет оценить влияние самих признаков на результат. Однако впоследствии планируется применить более сложные классификаторы. 

4. Результаты показали, что текущие признаки работают достаточно хорошо, однако для точных результатов необходим более продвинутый классификатор и существенно больше признаков учитывающих специфику задачи.

    
 <br />

#### Архитектура программного продукта

На текущий момент решение данной задачи можно разбить на две части:

Первая -- предварительная сегментация и обработка полученных суперпикселей. Для удобства работы связанные с этой частью функции вынесены в отдельный файл-библиотеку "presegmentation".

Вторая основная часть проекта связана с машинным обучением. Все функции собраны вместе в файл "main" и посвящен он в основном поиску наиболее оптимальных признаков (а также задаче их грамотного сочетания!)

 <br />

#### Инструкции по запуску:

Чтобы запустить процесс обучения, достаточно вызвать функцию learn на массиве из номеров тех фотографий, которые были выбраны в качестве обучающей выборки. (Обратите внимание, что программа работает в предположении, что названия всех снимков имеют вид: topN.tif, gtN.tif, dsmN.tif, где N -- номер снимка, а префиксы означают тип фотографии.) По окончании работы функция вернет обученный классификатор.

Чтобы проверить работу классификатора, нужно вызвать функцию classify, первый аргумент которой -- номер снимка, который будет сегментироваться, а второй -- классификатор полученый в результате описанного выше процесса. Эта функция возвращает размеченый аналогично Ground Truth снимок, после чего при помощи функции accuracy можно сравнить его с корректно размеченным снимком, а также узнать про различные метрики по каждому из типов объектов на снимках.
